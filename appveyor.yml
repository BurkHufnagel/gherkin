version: build{build}


environment:
  GherkinVersion: "3.3.0"
  GherkinPackageVersion: "$(GherkinVersion)-ci$(APPVEYOR_BUILD_NUMBER)"


nuget:
  project_feed: true
  disable_publish_on_pr: true

configuration: Release


before_build:
  - appveyor DownloadFile https://dist.nuget.org/win-x86-commandline/v3.2.0-rc/nuget.exe
  - appveyor DownloadFile https://raw.githubusercontent.com/appveyor/ci/master/scripts/nuget-restore.cmd
  - nuget-restore dotnet\Gherkin.CSharp.sln
  
build:
  publish_nuget: true  

after_build:
  - set paddedVersion=000%APPVEYOR_BUILD_NUMBER%
  - echo %paddedVersion%
  - set paddedVersion=%paddedVersion:~-3%
  - echo %paddedVersion%
  - set GherkinPaddedPackageVersion=%GherkinVersion%-ci%paddedVersion%
  - echo %GherkinPaddedPackageVersion%
  - nuget pack dotnet/Gherkin.NuGetPackages/Gherkin.nuspec -Version %GherkinPaddedPackageVersion%
  
artifacts:
- path: 'Gherkin.*.nupkg'
